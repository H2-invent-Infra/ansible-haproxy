---
- name: Create directory
  file:
    path: "{{ item.path }}"
    owner: "{{ haproxy_global_user }}"
    group: "{{ haproxy_global_group }}"
  when:
    - haproxy_copy_files | length > 0
    - item.path is defined
  with_items: "{{ haproxy_copy_files }}"

- name: Copy Content from Controller to HaProxy
  copy:
    content: "{{ item.content }}"
    dest: "{{ item.path }}/{{ item.dest | default('file.html') }}"
    owner: "{{ item.owner }}"
    group: "{{ item.group }}"
  when:
    - haproxy_copy_files | length > 0
    - item.content is defined
  notify: restart haproxy
  with_items: "{{ haproxy_copy_files }}"
